machine:
  php:
    version: 5.6.5
  hosts:
    localhost: 127.0.0.1

dependencies:
  override:
    - composer install --prefer-dist --no-interaction

test:
  pre:
    - bin/disable-php-email
    - bin/install-drupal
    - bin/start-webserver:
        background: true
    - bin/wait-for-webserver

  override:
    - bin/behat

  post:
    - bin/stop-webserver
    - ls -al $HOME/.ssh

deployment:
  live:
    branch: live
    commands:
      - cd drupal && ../bin/drush @wkweb.live ssh '(cd .. && git pull && composer install --no-dev)'
      - cd drupal && ../bin/drush @wkweb.live updatedb --yes
  stage:
    branch: master
    commands:
      - cd drupal && ../bin/drush @wkweb.stage ssh '(cd .. && git pull && composer install --no-dev)'
      - cd drupal && ../bin/drush @wkweb.stage updatedb --yes
